---
title: "DMSP Predictors"
author: "Sarah Kate Shore"
date: "April 2, 2016"
output: pdf_document
---
#What influences dimethylsulfoniopropionate (DMSP) produced in the South Atlantic Bight?
#Sarah Kate Shore

#First, load package vegan:
```{r}
library(vegan)
```

#Bring in data. There are three data sets, one for DMSP data, one for CTD data, and one for Pigment data. 
```{r}
setwd("/Users/SKate_Shore/quant_methods/Quant-Methods-Project.git/Data")
DMSP_June = read.csv("SAV15 Finalized Station DMS-P (Legs 1-3).csv", header = TRUE, fill = TRUE)
CTD_June = read.csv("SAVCTDJUN2015ALLDATA.csv", header = TRUE, fill = TRUE)
Pigs_June = read.csv("SAV JUN 15 Pig Extraction Log COMPLETE.csv", header = TRUE, fill = TRUE)
```

#Merge data sets. First create a unique id that corresponds with a row in the CTD data set. 
```{r}
DMSP_June$id = paste(DMSP_June$Station, DMSP_June$Nisken.no, sep='_')
CTD_June$id = paste(CTD_June$Station, CTD_June$Nisken.no, sep='_')
Nitrate_June$id = paste(Nitrate_June$Station, Nitrate_June$Nisken.no, sep='_')
Pigs_June$id = paste(Pigs_June$Station, Pigs_June$Nisken.no, sep='_')
```

#Merge into a master data set by performing Inner Joins
```{r}
DMSP_CTD = merge(DMSP_June, CTD_June, by="id", all=FALSE)
DMSP_CTD = merge(DMSP_CTD, Pigs_June, by="id", all=FALSE)
```

#Drop columns that contain inessential predictors
```{r}
fields_to_drop = c('id', 'Station', 'Station.x', 'Station.y', 
                   'X19.Hex.like.keto.Amount', 'Bot..Depth.m')
DMSP_CTD_vars = DMSP_CTD[ , !(names(DMSP_CTD) %in% fields_to_drop)]
rows_to_keep = which(apply(DMSP_CTD_vars, 1, function(x) !any(is.na(x))))
DMSP_CTD_vars = DMSP_CTD_vars[rows_to_keep, ]
```

#Ordination
# because of number of explanatory variabes, first examine their correlation structure to assess if any variables can be dropped
```{r}
pca = rda(scale(DMSP_CTD_vars))
pca
summary(pca)
plot(pca, display='sp', choices = c(1,2))
```

#Multiple Regression: perform ordinary least squares (ols) regression
```{r}
ols = lm(DMSP_CTD_vars$DMSPp.nmol..L.1 ~ . , data = DMSP_CTD_vars)
plot(ols)
abline(mod3)
abline(h=mean(DMSP_CTD_vars$DMSPp.nmol..L.1), col='pink', lwd=2)
legend('topleft', c('OLS fit', 'mean'), col=c('black', 'pink'), lty=1, lwd=c(1,2))
```

#Explore model
```{r}
summary(ols)
install.packages(car)
library(car)
Anova(ols, type = 3)
```


